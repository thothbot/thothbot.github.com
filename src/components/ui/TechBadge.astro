---
interface Props {
  name: string;
  years?: number;
  proficiency?: 'expert' | 'advanced' | 'proficient';
  projects?: string[];
  layer?: 'ai' | 'application' | 'services' | 'data' | 'infrastructure';
}

const {
  name,
  years,
  proficiency = 'proficient',
  projects = [],
  layer = 'services'
} = Astro.props;

const layerColors = {
  ai: {
    bg: 'bg-violet-500/20',
    border: 'border-violet-500/40',
    text: 'text-violet-200',
    glow: 'shadow-violet-500/20',
    ring: 'bg-violet-400',
  },
  application: {
    bg: 'bg-cyan-500/20',
    border: 'border-cyan-500/40',
    text: 'text-cyan-200',
    glow: 'shadow-cyan-500/20',
    ring: 'bg-cyan-400',
  },
  services: {
    bg: 'bg-blue-500/20',
    border: 'border-blue-500/40',
    text: 'text-blue-200',
    glow: 'shadow-blue-500/20',
    ring: 'bg-blue-400',
  },
  data: {
    bg: 'bg-emerald-500/20',
    border: 'border-emerald-500/40',
    text: 'text-emerald-200',
    glow: 'shadow-emerald-500/20',
    ring: 'bg-emerald-400',
  },
  infrastructure: {
    bg: 'bg-orange-500/20',
    border: 'border-orange-500/40',
    text: 'text-orange-200',
    glow: 'shadow-orange-500/20',
    ring: 'bg-orange-400',
  },
};

const colors = layerColors[layer];

const proficiencyDots = {
  expert: 3,
  advanced: 2,
  proficient: 1,
};

const dots = proficiencyDots[proficiency];
const hasTooltip = years || projects.length > 0;
---

<div class="tech-badge-wrapper relative group">
  <span
    class:list={[
      'tech-badge inline-flex items-center gap-2 px-3 py-1.5 rounded-full text-sm border',
      'transition-all duration-300 hover:scale-105 cursor-default',
      colors.bg,
      colors.border,
      colors.text,
      proficiency === 'expert' && `shadow-lg ${colors.glow}`,
    ]}
  >
    <span class="flex gap-0.5">
      {Array.from({ length: 3 }).map((_, i) => (
        <span
          class:list={[
            'w-1.5 h-1.5 rounded-full transition-all duration-300',
            i < dots ? colors.ring : 'bg-white/20',
          ]}
        />
      ))}
    </span>
    <span>{name}</span>
    {years && (
      <span class="text-xs opacity-60">{years}y</span>
    )}
  </span>

  {hasTooltip && (
    <div class="tooltip absolute bottom-full left-1/2 -translate-x-1/2 mb-2 px-3 py-2 rounded-lg bg-slate-900/95 border border-white/10 text-xs text-white/80 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap z-50 pointer-events-none">
      {years && <div class="font-medium text-white">{years} years experience</div>}
      {projects.length > 0 && (
        <div class="mt-1 text-white/60">
          Used in: {projects.join(', ')}
        </div>
      )}
      <div class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-900/95"></div>
    </div>
  )}
</div>

<style>
  .tech-badge-wrapper:hover .tech-badge {
    background: rgba(255, 255, 255, 0.12);
  }
</style>
